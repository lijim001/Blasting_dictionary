#网关支付
##产品说明


##支付流程


 

##请求参数
请求方式为post

<table>
    <tr>
        <th>属性名称</th>
        <th>含义</th>
        <th>属性类型</th>
        <th>属性长度</th>
        <th>强制可选</th>
        <th>备注</th>
        <th>示例</th>
    </tr>
    <tr>
        <td>orderNo</td>
        <td>商户订单号</td>
        <td>String</td>
        <td>12-54</td>
        <td>Y</td>
        <td>订单号</td>
        <td></td>
    </tr>
    <tr>
        <td>appId</td>
        <td>应用编号</td>
        <td>String</td>
        <td>17</td>
        <td>Y</td>
        <td>应用编号</td>
        <td>20170920800000049</td>
    </tr>
    <tr>
        <td>channel</td>
        <td>支付通道</td>
        <td>String</td>
        <td>20</td>
        <td>Y</td>
        <td>支付通道</td>
        <td>yb_pc</td>
    </tr>
    <tr>
        <td>amount</td>
        <td>金额</td>
        <td>String</td>
        <td>12</td>
        <td>Y</td>
        <td>金额，单位是分</td>
        <td>1000</td>
    </tr>
    <tr>
        <td>clientIp</td>
        <td>客户端ip</td>
        <td>String</td>
        <td>15</td>
        <td>N</td>
        <td>可不填</td>
        <td>127.0.0.1</td>
    </tr>
    <tr>
        <td>currency</td>
        <td>币种</td>
        <td>String</td>
        <td>10</td>
        <td>N</td>
        <td>默认CNY</td>
        <td>CNY</td>
    </tr>
    <tr>
        <td>subject</td>
        <td>订单标题</td>
        <td>String</td>
        <td>60</td>
        <td>N</td>
        <td>订单标题</td>
        <td>我是订单标题</td>
    </tr>
    <tr>
        <td>callBackUrl</td>
        <td>同步回调url</td>
        <td>String</td>
        <td>200</td>
        <td>Y</td>
        <td>支付结果同步通知地址</td>
        <td>http://www.baidu.com</td>
    </tr>
    <tr>
        <td>timeoutExpress</td>
        <td>订单超时时间</td>
        <td>String</td>
        <td>13</td>
        <td>Y</td>
        <td>订单过期时间戳</td>
        <td>1506139638370</td>
    </tr>
    <tr>
        <td>desc</td>
        <td>订单说明</td>
        <td>String</td>
        <td>500</td>
        <td>Y</td>
        <td>订单说明</td>
        <td>我是订单说明</td>
    </tr>
    <tr>
        <td>callBackParam</td>
        <td>自定义参数</td>
        <td>String</td>
        <td>128</td>
        <td>Y</td>
        <td>同步/异步通知时候原样返回，必须要进行url encode</td>
        <td></td>
    </tr>
    <tr>
        <td>sign</td>
        <td>签名数据</td>
        <td>String</td>
        <td>256</td>
        <td>Y</td>
        <td>签名结果</td>
        <td></td>
    </tr>
    <tr>
        <td>toAccountType</td>
        <td>到账类型</td>
        <td>String</td>
        <td>5</td>
        <td>Y</td>
        <td>D0/T1,不同到账类型费率不同</td>
        <td>D0</td>
    </tr>
    <tr>
        <td>orderTime</td>
        <td>订单时间</td>
        <td>String</td>
        <td>14</td>
        <td>Y</td>
        <td>yyyyMMddHHmmss</td>
        <td>20170923121721</td>
    </tr>
    <tr>
        <td>extra</td>
        <td>扩展字段</td>
        <td>String</td>
        <td>500</td>
        <td>Y</td>
        <td>扩展字段属性</td>
        <td></td>
    </tr>
</table>



##extra扩展字段说明
不同的支付通道需要传入不同extra字段。 目前只支持yb_pc支付通道。 

- yb_pc的说明
extra的值使用json格式，并且需要做url encode。字段说明如下:

<table>
    <tr>
        <th>属性名称</th>
        <th>含义</th>
        <th>属性类型</th>
        <th>属性长度</th>
        <th>强制可选</th>
        <th>备注</th>
        <th>示例</th>
    </tr>
    <tr>
        <td>paymentModeCode</td>
        <td>银行编号</td>
        <td>String</td>
        <td>35</td>
        <td>Y</td>
        <td>银行编号,见页低</td>
        <td>BANK_CARD-B2C-ICBC-P2P</td>
    </tr>
</table>

##返回参数

<table>
    <tr>
        <th>属性名称</th>
        <th>含义</th>
        <th>属性类型</th>
        <th>属性长度</th>
        <th>强制可选</th>
        <th>备注</th>
        <th>示例</th>
    </tr>
    <tr>
        <td>appCode</td>
        <td>应用编号</td>
        <td>String</td>
        <td>17</td>
        <td>Y</td>
        <td>应用编号</td>
        <td>20170928800000056</td>
    </tr>
    <tr>
        <td>orderNo</td>
        <td>系统订单号</td>
        <td>String</td>
        <td>35</td>
        <td>Y</td>
        <td>系统订单号</td>
        <td>2017092632112308111101100z000744889</td>
    </tr>
    <tr>
        <td>orderTitle</td>
        <td>订单标题</td>
        <td>String</td>
        <td>60</td>
        <td>Y</td>
        <td>订单标题</td>
        <td>iphone x</td>
    </tr>
    <tr>
        <td>orderAmount</td>
        <td>订单金额</td>
        <td>String</td>
        <td>12</td>
        <td>Y</td>
        <td>订单金额</td>
        <td>8000</td>
    </tr>
    <tr>
        <td>merchantOrderNo</td>
        <td>商户订单号</td>
        <td>String</td>
        <td>12-54</td>
        <td>Y</td>
        <td>商户订单号</td>
        <td></td>
    </tr>
    <tr>
        <td>transactionResult</td>
        <td>交易结果</td>
        <td>String</td>
        <td>20</td>
        <td>Y</td>
        <td>支付成功(paid),支付失败(paid_fail),支付中(paying)</td>
        <td>paid</td>
    </tr>
    <tr>
        <td>channelType</td>
        <td>支付通道</td>
        <td>String</td>
        <td>20</td>
        <td>Y</td>
        <td>可在应用中申请支付通道</td>
        <td>yb_pc</td>
    </tr>
    <tr>
        <td>customizeParam</td>
        <td>自定义参数</td>
        <td>String</td>
        <td>128</td>
        <td>Y</td>
        <td>自定义参数，原样返回</td>
        <td></td>
    </tr>
    <tr>
        <td>orderTime</td>
        <td>订单时间</td>
        <td>String</td>
        <td>14</td>
        <td>Y</td>
        <td>yyyyMMddHHmmss</td>
        <td></td>
    </tr>
    <tr>
        <td>sign</td>
        <td>签名</td>
        <td>String</td>
        <td>256</td>
        <td>Y</td>
        <td>RSA/SHA1</td>
        <td></td>
    </tr>
    <tr>
        <td>signType</td>
        <td>签名类型</td>
        <td>String</td>
        <td>20</td>
        <td>N</td>
        <td>目前只支持RSA/SHA1，不参与签名</td>
        <td>SHA1WithRSA</td>
    </tr>
</table>

##签名
目前只支持RSA/SHA1签名算法，待签名文案拼接逻辑为：
将参数名按照自然书序排序后，按照url参数的方式完成拼接，即a=a&b=b.
代码如下
        

  $PostUrl="amount=".$amount."&appId=".$AppId."&callBackUrl=".$CallBackUrl."&channel=".$channel.'&'.'c'.'urrency='
  .$Currency."&desc=".$desc."&extra=".$extra."&orderNo=".$OrderNo."&orderTime=".$orderCreateTime
  ."&subject=".$subject."&toAccountType=".$toAccountType;

加签代码如下:

	
    function rsaSign($data,$res) {
    openssl_sign($data, $sign, $res);
    openssl_free_key($res);
    //base64编码
    $sign = base64_encode($sign);
    return $sign;
}

##验签
待验签文案拼接和加签的文案拼接逻辑一致，去除sign和signType字段

验签代码如下

   function rsaVerify($prestr, $sign,$pkeyid) {
	$sign = base64_decode($sign);
    if ($pkeyid) {
        $verify = openssl_verify($prestr, $sign, $pkeyid);
        openssl_free_key($pkeyid);
    }
    if($verify == 1){
        return true;
    }else{
        return false;
    }
}

##银行编号
BANK_CARD-B2C-POST-P2P          邮政储蓄银行

BANK_CARD-B2C-SDB-P2P           深圳发展银行

BANK_CARD-B2C-CMBC-P2P          民生银行

BANK_CARD-B2C-BCCB-P2P          北京银行

BANK_CARD-B2C-SHB-P2P           上海银行

BANK_CARD-B2C-CMBCHINA-P2P      招商银行

BANK_CARD-B2C-ECITIC-P2P        中信银行

BANK_CARD-B2C-SPDB-P2P          浦发银行

BANK_CARD-B2C-CIB-P2P           兴业银行

BANK_CARD-B2C-HXB-P2P           华夏银行

BANK_CARD-B2C-ABC-P2P           农业银行

BANK_CARD-B2C-GDB-P2P           广发银行

BANK_CARD-B2C-ICBC-P2P          工商银行

BANK_CARD-B2C-BOC-P2P           中国银行

BANK_CARD-B2C-BOCO-P2P          交通银行

BANK_CARD-B2C-CCB-P2P           建设银行

BANK_CARD-B2C-PINGANBANK-P2P    平安银行

BANK_CARD-B2C-CEB-P2P           光大银行
